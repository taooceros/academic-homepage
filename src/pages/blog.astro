---
import { getCollection } from "astro:content";
import Header from "../components/Header.astro";
import "../styles/main.css";

// Get all blog posts and sort by date (newest first)
const blogPosts = await getCollection("blog");
const sortedPosts = blogPosts.sort(
	(a, b) => new Date(b.data.date).getTime() - new Date(a.data.date).getTime(),
);
---

<html lang="en">
	<head>
		<meta charset="utf-8" />
		<link
			rel="icon"
			type="image/svg+xml"
			href={`${import.meta.env.BASE_URL}favicon.svg`}
		/>
		<meta name="viewport" content="width=device-width, initial-scale=1.0" />
		<meta name="generator" content={Astro.generator} />
		<title>Blog - Hongtao Zhang</title>

		<Header />
	</head>
	<body>
		<main class="blog-main">
			{
				sortedPosts.length === 0 ? (
					<p class="empty-state">
						No blog posts yet. Check back soon!
					</p>
				) : (
					<div class="post-grid">
						{sortedPosts.map((post) => (
							<article class="post-card-wrapper">
								<a
									href={`${import.meta.env.BASE_URL}blog/${post.id}`}
									class="post-card"
								>
									<div class="post-meta">
										<time
											datetime={post.data.date.toISOString()}
										>
											{post.data.date.toLocaleDateString(
												"en-US",
												{
													year: "numeric",
													month: "short",
													day: "numeric",
												},
											)}
										</time>
									</div>
									<h3>{post.data.title}</h3>
									{post.data.description && (
										<p class="post-description">
											{post.data.description}
										</p>
									)}
								</a>
							</article>
						))}
					</div>
				)
			}
		</main>
	</body>
</html>
