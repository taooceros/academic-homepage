---
import { getCollection } from "astro:content";
import Layout from "../layouts/Layout.astro";

// Get all blog posts and sort by date (newest first)
const blogPosts = await getCollection("blog");
const sortedPosts = blogPosts.sort(
  (a, b) => new Date(b.data.date).getTime() - new Date(a.data.date).getTime()
);
---

<Layout title="Blog - Hongtao Zhang">
  <main>
    <h1 class="component-title">Blogs</h1>
    {
      sortedPosts.length === 0 ?
        <p class="text-center text-(--gray-color) text-lg">
          No blog posts yet. Check back soon!
        </p>
      : <div class="grid grid-cols-1 md:grid-cols-2 gap-12 list-none p-0">
          {sortedPosts.map((post) => (
            <article class="flex">
              <a
                href={`${import.meta.env.BASE_URL}blog/${post.id}`}
                class="flex flex-col bg-(--paper-card-bg) hover:bg-black/10 rounded-2xl transition-all duration-300 relative no-underline text-inherit border border-black/10 hover:shadow-md overflow-hidden group"
              >
                {post.data.image && (
                  <div class="h-[200px] overflow-hidden">
                    <img
                      src={post.data.image}
                      alt={post.data.title}
                      class="w-full h-full object-cover"
                    />
                  </div>
                )}

                <div class="flex flex-col p-8 grow">
                  <h3 class="text-2xl m-0 font-semibold text-(--main-color) line-height-tight">
                    {post.data.title}
                  </h3>
                  {post.data.description && (
                    <p class="text-base text-(--gray-color) m-0 mt-4 leading-relaxed grow">
                      {post.data.description}
                    </p>
                  )}

                  <div class="flex justify-between items-center mt-auto mb-0 text-(--gray-color) uppercase tracking-widest text-[0.7rem] font-medium">
                    <time
                      datetime={post.data.date.toISOString()}
                      class="text-[0.8rem]"
                    >
                      {post.data.date.toLocaleDateString("en-US", {
                        year: "numeric",
                        month: "short",
                        day: "numeric",
                      })}
                    </time>
                  </div>
                </div>
              </a>
            </article>
          ))}
        </div>
    }
  </main>
</Layout>
