---
import { getCollection } from "astro:content";
import Layout from "../../layouts/Layout.astro";

export async function getStaticPaths() {
	const blogPosts = await getCollection("blog");

	// Import each blog post's content with the special Typst query
	const postsWithContent = await Promise.all(
		blogPosts.map(async (post) => {
			try {
				const contentModule = await import(
					`../../../content/blog/${post.id}.typ?html&body`
				);
				return {
					params: { slug: post.id },
					props: {
						post,
						Content: contentModule.default,
					},
				};
			} catch (error) {
				console.error(`Failed to load content for ${post.id}:`, error);
				return {
					params: { slug: post.id },
					props: {
						post,
						Content: null,
					},
				};
			}
		}),
	);

	return postsWithContent;
}

const { post, Content } = Astro.props;
---

<Layout title={`${post.data.title} - Academic Homepage`}>
	<meta
		slot="head"
		name="viewport"
		content="width=device-width, initial-scale=1.0"
	/>
	<link
		slot="head"
		rel="stylesheet"
		href="https://fred-wang.github.io/MathFonts/NewComputerModern/mathfonts.css"
	/>
	<main
		class="max-w-[min(50rem,calc(100%-2em))] mx-auto py-12 px-4 shadow-none"
	>
		<article class="bg-transparent">
			<div class="pb-6">
				<h1
					class="text-3xl md:text-4xl font-bold text-gray-900 leading-tight mb-2"
				>
					{post.data.title}
				</h1>
				<div
					class="flex gap-4 mt-2 text-sm text-gray-500 font-medium font-italic"
				>
					<div class="text-gray-600 text-[0.8rem]">
						{
							post.data.date.toLocaleDateString("en-US", {
								year: "numeric",
								month: "long",
								day: "numeric",
							})
						}
					</div>
				</div>
			</div>

			<div class="prose lg:prose-l">
				{Content ? <Content /> : <p>Content could not be loaded.</p>}
			</div>

			<footer class="mt-12 bg-transparent! p-0!">
				<a
					href={`${import.meta.env.BASE_URL}blog`}
					class="inline-flex items-center gap-2 py-3 px-6 bg-slate-50 border border-slate-200 rounded-lg text-gray-600 no-underline font-medium transition-all duration-200 hover:bg-slate-100 hover:border-slate-300 hover:text-slate-900 hover:-translate-x-0.5"
				>
					‚Üê Back to Blog
				</a>
			</footer>
		</article>
	</main>
</Layout>
